DOMAIN_NAME: battery
Slots:
Topics:
params: { }
Services: none
params: {error_battery_level: 11.5
    warn_battery_level: 12.2
    capacity_ah: 10.0
    battery_type: LiFePo4
    nominal_voltage: 13.2}
Diagnostics (event messages): - Battery OK - Empty battery - Low battery - No communication
Robot_state keys utiles: - Voltage (V) - _Type - _Nominal Voltage (V) - _Capacity (Ah) - Status - Charge Mode - External Power - PC On - Boards On - Charge Mode Description - Estimated Extras W (W)
Contraintes: - rÃ©ponses courtes, FR, pas d'humour

pour information l'extrait de la publication du diagnostique dans le controller .cpp de battery :
" tatus.add("Voltage (V)", formatDouble(voltage));
    status.add("_Type", battery_type_);
    status.add("_Nominal Voltage (V)", formatDouble(nominal_voltage_));
    status.add("_Capacity (Ah)", formatDouble(capacity_ah_));
    status.add("Status", std::to_string(stat_));

    uint8_t charge_mode = (stat_ >> 3) & 0x07;  // bits 5-3
    bool ext_power = (stat_ >> 2) & 0x01;       // bit 2
    bool pc_on     = (stat_ >> 1) & 0x01;       // bit 1
    bool boards_on = stat_ & 0x01;              // bit 0

    status.add("Charge Mode", std::to_string(charge_mode));
    status.add("External Power", ext_power ? "Yes" : "No");
    status.add("PC On", pc_on ? "Yes" : "No");
    status.add("Boards On", boards_on ? "Yes" : "No");

    std::string charge_desc;
    switch (charge_mode) {
        case 1:
            charge_desc = "Charging (constant current)";
            break;
        case 2:
            charge_desc = "Charging (constant voltage)";
            break;
        case 3:
            charge_desc = "Fully charged";
            break;
        case 4:
            charge_desc = "Battery operation";
            break;
        default:
            charge_desc = "Unknown/invalid charge mode";
            break;
    }
    status.add("Charge Mode Description", charge_desc);

    if (last_estimated_runtime_minutes_ > 0.0) {
        status.add("Estimated Runtime (min)", formatDouble(last_estimated_runtime_minutes_));
        status.add("Estimated Power (W)", formatDouble(total_power_w));
    }
    status.add("Estimated Extras W (W)", formatDouble(fixed_extra_power_w));

    // Niveau batterie
    if (voltage < error_battery_level_) {
        status.summary(diagnostic_msgs::msg::DiagnosticStatus::ERROR, "Empty battery");
    } else if (voltage <= warn_battery_level_) {
        status.summary(diagnostic_msgs::msg::DiagnosticStatus::WARN, "Low battery");
    } else {
        status.summary(diagnostic_msgs::msg::DiagnosticStatus::OK, "Battery OK");
    }
"